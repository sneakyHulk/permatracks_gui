#include <filesystem>

#include "MLOptimizer.h"

int main() {
	MLOptimizer<25> optimizer;
	optimizer.set_model(std::filesystem::path(CMAKE_SOURCE_DIR) / "data" / "models" / "inverse_biot_savart_net_encoder_decoder_with_direction_25_5000000.pt");

	Message<Array<MagneticFluxDensityData, 25>> out;

	for (auto i = 0; auto& [x, y, z] : out) {
		constexpr std::array<float, 75> test_data = {1.84551319e-06, -4.19744260e-06, -7.04214227e-06, 3.12519719e-06, -3.75042315e-06, -5.05861170e-06, 3.17402510e-06, -3.06140102e-06, -2.91197957e-06, 2.56802518e-06, -2.35634930e-06,
		    -1.38985024e-06, 1.86081467e-06, -1.76135343e-06, -5.32370071e-07, 1.87994725e-06, -1.20879367e-06, -8.19221714e-06, 3.35603337e-06, -1.37823851e-06, -6.17056965e-06, 3.54963637e-06, -1.44378935e-06, -3.84412264e-06,
		    2.98212659e-06, -1.35222660e-06, -2.07555324e-06, 2.23404048e-06, -1.16480945e-06, -9.95978733e-07, 1.58237656e-06, 1.22357017e-06, -7.17661888e-06, 2.94377203e-06, 6.92338862e-07, -5.64554639e-06, 3.27442707e-06,
		    1.10931317e-07, -3.76713257e-06, 2.89997770e-06, -2.88032666e-07, -2.22045582e-06, 2.28036983e-06, -4.75558809e-07, -1.19198449e-06, 1.17958194e-06, 2.36453644e-06, -5.31317492e-06, 2.26406024e-06, 1.79377468e-06,
		    -4.35029899e-06, 2.65175253e-06, 1.08321111e-06, -3.09421247e-06, 2.48957406e-06, 4.87589139e-07, -1.97133285e-06, 2.07045872e-06, 9.55669662e-08, -1.15527666e-06, 8.26952983e-07, 2.54677716e-06, -3.60018868e-06, 1.62108087e-06,
		    2.08836562e-06, -3.05018112e-06, 1.98811165e-06, 1.47315249e-06, -2.29389932e-06, 1.97321547e-06, 8.97842422e-07, -1.56488089e-06, 1.73560427e-06, 4.62305844e-07, -9.88548937e-07}; /*,2.79866952e-06, -2.69896219e-06,
		    -7.01125967e-06, 3.53103255e-06, -2.47249084e-06, -4.63365241e-06, 3.19272552e-06, -2.10031403e-06, -2.55895363e-06, 2.45728768e-06, -1.68632523e-06, -1.22028846e-06, 2.63347820e-06, -2.44494770e-08, -7.08849306e-06,
		    3.47518016e-06, -4.43187478e-07, -4.96757400e-06, 3.29337022e-06, -7.31033121e-07, -2.98371648e-06, 2.64954318e-06, -8.24489593e-07, -1.59849471e-06, 2.10082720e-06, 1.69263833e-06, -5.73875212e-06, 2.90109925e-06,
		    1.01496907e-06, -4.25201824e-06, 2.90699715e-06, 3.85345273e-07, -2.75327433e-06, 2.47280456e-06, -3.58199700e-08, -1.61212792e-06, 1.52249387e-06, 2.31561223e-06, -4.09396999e-06, 2.18872478e-06, 1.68044559e-06,
		    -3.18890562e-06, 2.31728458e-06, 1.01795573e-06, -2.20967403e-06, 2.08919179e-06, 4.96901596e-07, -1.39793030e-06};*/
		x = test_data[i++];
		y = test_data[i++];
		z = test_data[i++];
	}

	std::cout << optimizer.process(out) << std::endl;
}
